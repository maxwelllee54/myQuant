# 贝叶斯推断实践指南 (Bayesian Inference Guide)

本文件旨在解释`quant-investor`技能V2.0中贝叶斯模块的核心思想和实践应用。

## 1. 为什么需要贝叶斯？

传统（频率派）统计学将模型参数（如Alpha、Beta）视为一个固定的、未知的真值。而贝叶斯学派认为，参数本身就是不确定的，应该用一个**概率分布**来描述我们对它的**信念**。这种思想特别适合金融市场，因为市场的“真理”本身就在不断变化。

**核心优势**:
- **量化不确定性**: 我们得到的不是一个单一的参数估计值，而是一个完整的后验分布，直观地展示了参数可能的所有取值及其概率。
- **融合先验知识**: 允许我们将经济理论、专家观点或历史经验（先验）与新数据（似然）系统性地结合起来。
- **动态适应**: 随着新数据的到来，模型可以自动更新其信念（后验），非常适合非平稳的金融时间序列。
- **小样本友好**: 在数据较少时，一个合理的先验可以有效防止模型过拟合。

## 2. 核心工作流：先验 -> 似然 -> 后验

`bayesian_updater.py`脚本的核心就是实现这个流程。

### 2.1 先验分布 (Prior Distribution)

这是我们对参数的初始信念，在看到任何新数据之前设定。

- **来源**:
    1.  **无信息先验**: 当我们对参数一无所知时，使用非常宽的正态分布或均匀分布。例如，`Alpha ~ Normal(0, 100)`。
    2.  **弱信息先验**: 基于一些基本常识。例如，我们知道股票的Beta通常在0到3之间，可以设定`Beta ~ Normal(1, 1)`。
    3.  **强信息先验**: 基于坚实的理论或历史数据。例如，根据CAPM模型，我们可以设定市场超额收益的先验为`Market_Return ~ Normal(0.06, 0.15)`。

- **实践**: 在`config.ini`中，用户可以为关键参数（如Alpha、Beta、波动率）选择并设定先验分布。

### 2.2 似然函数 (Likelihood Function)

似然函数描述了在给定一组参数的情况下，我们观察到的数据出现的概率。它将我们的模型与真实数据连接起来。

- **示例**: 在一个简单的线性回归模型 `y = α + β*x + ε` 中，似然函数通常假设残差 `ε` 服从正态分布 `Normal(0, σ)`。那么，给定α, β, σ，我们就可以计算出观测到所有 `(x, y)` 数据点的联合概率。

### 2.3 后验分布 (Posterior Distribution)

后验分布是贝叶斯推断的最终产物，它是在综合了先验信念和新数据后，我们对参数的更新后的信念。

**P(参数 | 数据) ∝ P(数据 | 参数) × P(参数)**
(后验 ∝ 似然 × 先验)

- **计算**: 由于后验分布通常难以直接计算，我们使用**马尔可夫链蒙特卡洛 (MCMC)** 方法（如NUTS算法）从后验分布中进行抽样。`PyMC`库为我们处理了复杂的MCMC采样过程。

- **解读**: `bayesian_updater.py`会输出后验分布的关键统计量和可视化图：
    - **均值/中位数**: 参数的点估计值。
    - **94% HDI (Highest Density Interval)**: 参数最可信的94%取值范围，类似于频率派的置信区间但解释更直观。
    - **分布图**: 直观地看到参数的不确定性有多大。

## 3. 在量化策略中的具体应用

### 3.1 动态参数估计

- **场景**: 一个均值回归策略的半衰期不是固定的。我们可以用贝叶斯方法来动态估计它。
- **流程**:
    1.  **T=0**: 设定半衰期的先验分布（例如，Gamma分布）。
    2.  **T=1**: 观察到新的价格数据，计算似然，得到第一个后验分布。
    3.  **T=2**: 将T=1的后验作为T=2的先验，结合新数据，再次更新，得到新的后验。
    - **结果**: 我们得到一个随时间变化的、对半衰期的信念分布，策略可以根据这个分布动态调整其交易频率。

### 3.2 Black-Litterman 模型的贝叶斯诠释

Black-Litterman模型是贝叶斯思想在资产配置中的经典应用。

- **先验**: 市场均衡隐含的预期收益率（通过反向优化从市值权重得出）。这是一个“市场共识”的、稳健但可能平庸的先验。
- **观点 (似然)**: 投资者对某些资产有自己的主观预测（例如，“我认为未来一年科技股将跑赢大盘5%”）。每个观点都带有一定的不确定性。
- **后验**: 模型将投资者的主观观点与市场均衡先验相结合，得出一个既反映市场共识又体现个人洞见的、新的预期收益率向量，用于最终的均值-方差优化。

### 3.3 模型比较与选择

- **场景**: 我们有两个不同的模型来预测收益率，哪个更好？
- **方法**: 贝叶斯框架提供了**WAIC (Watanabe-Akaike Information Criterion)** 和 **LOO (Leave-One-Out Cross-Validation)** 等指标来比较模型的样本外预测能力。这些指标惩罚了模型的复杂性，帮助我们选择既拟合良好又不过分复杂的模型。

## 4. 实践建议

- **从弱信息先验开始**: 除非有非常强的理论依据，否则优先使用弱信息先验，让数据自己说话。
- **进行先验敏感性分析**: 测试不同的先验对最终结果的影响。如果结果对先验非常敏感，说明数据本身提供的信息不足。
- **检查MCMC收敛性**: 确保采样过程已经收敛到平稳的后验分布。`PyMC`提供了`az.summary()`等工具来诊断收敛性（如`r_hat`指标应接近1）。
- **后验预测检验**: 从后验分布中生成模拟数据，看它与真实数据的相似程度。这是检验模型拟合好坏的黄金标准。
