# 统计检验方法论 (Statistical Framework)

本文件详细阐述了`quant-investor`技能V2.0中使用的核心统计检验方法，旨在确保策略的稳健性和可靠性。

## 1. 回测过拟合与多重检验

**问题**: 当我们在同一数据集上测试大量因子、参数或模型时，即使它们完全无效，也极有可能因为随机性而发现“显著”的结果。这就是**数据挖掘偏差 (Data Snooping Bias)**。

**解决方案**: 我们采用严格的多重检验校正方法。

### 1.1 族系误差率 (Family-Wise Error Rate, FWER)

- **Bonferroni 校正**: 最简单但最严格的方法。如果进行了n次检验，则将单次检验的显著性水平α从0.05调整为α/n。过于保守，可能拒绝掉真正有效的策略。

### 1.2 错误发现率 (False Discovery Rate, FDR)

- **Benjamini-Hochberg (BH) 程序**: 一种更现代、更强大的方法。它不试图完全避免假阳性，而是将其控制在一个可接受的比例（如5%）内。这在发现新因子时特别有用。

**实践**: `statistical_validator.py`脚本会自动记录检验次数，并计算每个策略的q值（经过FDR校正的p值），只有q值小于0.05的策略才被认为是初步有效的。

## 2. Bootstrap 检验

**问题**: 夏普比率等性能指标是点估计值，本身具有不确定性。一个回测中夏普比率为1.5的策略，可能在另一次历史中只有0.5。

**解决方案**: 使用Bootstrap方法来量化这种不确定性。

### 2.1 平稳Bootstrap (Stationary Bootstrap)

- **方法**: 我们从策略的日收益率序列中进行有放回的重采样，但为了保留其自相关性，我们采样的是“数据块”而非单个数据点。通过数千次重采样，我们得到数千个模拟的夏普比率分布。

- **应用**:
    1.  **夏普比率置信区间**: 报告夏普比率的95%置信区间。如果该区间包含0，则我们无法在统计上拒绝“策略无效”的零假设。
    2.  **p值计算**: 计算模拟的夏普比率中小于0的比例，得到策略收益不显著的p值。

## 3. 蒙特卡洛模拟 (Monte Carlo Simulation)

**问题**: 回测只代表了历史的一种可能路径。我们需要评估策略在其他可能路径下的表现，特别是其风险特征。

**解决方案**: 基于回测的交易记录进行蒙特卡洛模拟。

- **方法**: 随机打乱回测中所有交易的顺序，重新计算数千条不同的权益曲线。这模拟了“如果交易发生的时机不同”会发生什么。

- **应用**:
    1.  **最大回撤分布**: 得到最大回撤的概率分布，而不仅仅是历史上的那一个值。我们可以评估“95%概率下最大回撤不会超过X%”。
    2.  **破产风险**: 计算在模拟路径中权益曲线跌破某个阈值（如初始资金的50%）的概率。

## 4. 因子稳定性检验：信息系数 (IC)

**问题**: 一个好的因子不仅要有效，更要稳定。一个时而有效时而无效的因子是危险的。

**解决方案**: 深入分析信息系数（IC）。

- **IC均值**: 衡量因子的平均预测能力。月度IC > 0.05通常被认为有价值。
- **IC标准差**: 衡量因子预测能力的波动性。
- **信息比率 (IC_IR)**: IC均值 / IC标准差。这是最重要的指标，衡量了因子的稳定性。IC_IR > 0.5被认为是稳定的信号。
- **滚动IC**: 绘制12个月或24个月的滚动IC均值，观察因子是否存在“衰减”或周期性失效。

**实践**: `ic_analysis.py`脚本会生成完整的IC分析报告，包括上述所有指标和图表，作为策略开发的第一道关卡。

## 5. 总结：一个稳健的验证流程

一个策略必须通过以下所有检验，才能被认为是初步可靠的：

1.  **IC检验**: 核心因子必须具有统计显著且稳定的IC_IR (>0.5)。
2.  **WFO检验**: 在样本外数据上依然表现良好，关键性能指标没有大幅衰减。
3.  **Bootstrap检验**: 夏普比率的95%置信区间下限必须显著大于0。
4.  **多重检验校正**: 策略的q值必须小于0.05。
5.  **蒙特卡洛检验**: 在95%的模拟路径中，最大回撤必须在可接受范围内。

只有通过这五重考验，我们才能更有信心地认为，我们发现的是一个真正的Alpha，而不仅仅是数据挖掘出来的噪音。
